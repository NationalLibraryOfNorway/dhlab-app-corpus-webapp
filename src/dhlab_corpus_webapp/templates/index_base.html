{% extends "base.html" %}

{% block content %}
<main>
    <header>
    {% include 'banner.html' with context %}
            <h1>Korpus</h1>

            <p>Med denne appen kan man lage et <a href="https://www.nb.no/dh-lab/">DH-LAB</a>-korpus av tekster fra <a href="https://www.nb.no/dh-lab/">Nasjonalbibliotekets</a> samling.</p>
            
            <details>
                <summary>Hvordan fungerer korpusappen?</summary>
                <p>Et DHLAB-korpus gjør at man kan gjøre kvantitative analyser av tekstsamlinger som inkluderer opphavsrettsbeskyttet materiale. I stedet for å laste ned tekstene, får man en kode for hver tekst. Denne kan så lastes opp i andre DHLAB-apper for å gjøre analyser på den teksten.</p>
            <p>DHLAB tilbyr følgende ressurstyper: <strong>Digibok:</strong> Bøker fra Nasjonalbiblioteket <strong>Digavis:</strong> Aviser fra Nasjonalbiblioteket <strong> Digitidsskrift:</strong> Tidsskrift fra Nasjonalbiblioteket <strong>Digistorting:</strong> Stortingsdokumenter i NBs samling Digimanus: Brev og manuskripter <strong> Kudos:</strong> <a href= "https://kudos.dfo.no/"> Kunnskapsdokumenter i offentlig sektor</a>  <strong>Nettavis:</strong> Tekster fra nettaviser</p>
            </details>

            <!--Denne trenger man pga hx-target="#form-feedback" i div-en under-->
            <div class="form-feedback">
                <div id="form-feedback">
                </div>
            </div>

            <!--Form som sørger for at inputen blir sendt videre til flask-->
            <form id="search-form" hx-trigger= "clicked, submit", hx-post="/submit-form" hx-target="#form-feedback" hx-swap="outerHTML">
            
            <!--Dropdownmeny for valg av dokumenttype-->
            <div class="search-container">
                <div id="search-type-selection">
                    <label for="search-type" class="search-type-label">Dokumenttype:
                        <span class="help-icon" title="Følger Nasjonalbibliotekets digitale dokumenttyper.">?</span>
                    </label>  
                    <select name="doc_type_selection" hx-get="search_type" hx-target="#search">
                        <option value="digibok">Digibok</option>
                        <option value="digavis">Digavis</option>
                        <option value="digitidsskrift">Digitidskrift</option>
                        <option value="difistorting">Digistorting</option>
                        <option value="digimanus">Digimanus</option>
                        <option value="kudos">Kudos</option>
                        <option value="nettavis">Nettavis</option>
                    </select>
                </div>

            <!--Dropdownmeny for valg av språk-->
                <div id="search-type-selection">
                    <label for="search-type" class="search-type-label">Språk:
                        <span class="help-icon" title="Velg språk fra listen.">?</span>
                    </label>
                    <select name="type_" hx-get="search_type" hx-target="#search">
                        <option value="lang">Norsk</option>
                    </select>
                </div>

            <!--Felt for valg av forfatter-->
                <div id="search-type-selection">
                    <label for="name">Forfatter:
                        <span class="help-icon" title="Feltet blir kun tatt hensyn til for digibok.">?</span>
                    </label>
                    <input type="text" id="author" name="author" placeholder="Henrik Ibsen" />
                </div>

            <!--Felt for valg av tittel-->
                <div id="search-type-selection">
                    <label for="name">Tittel:
                        <span class="help-icon" title="Søk etter titler. For aviser vil tittel matche avisnavnet.">?</span>
                    </label>
                    <input type="text" id="title" name="title" placeholder="Et dukkehjem" />
                </div>

            <!--Felt for valg av ord eller fraser i teksten-->
                <div id="search-type-selection">
                    <label for="name">Ord eller fraser i teksten:
                        <span class="help-icon" title="Søketreff er uavhengig av stor og liten bokstav. Du kan søke trunkert med . For eksempel vil demokrat returnere tekster som inneholder demokrati og demokratisk blant andre treff.">?</span>
                    </label>
                    <input type="text" id="words_or_phrases" name="words_or_phrases" placeholder="Lerkefugl" />
                </div>

            <!--Felt for valg av dewey desimaltall-->
                <div id="search-type-selection">
                    <label for="dewey">Dewey desimaltall:
                        <span class="help-icon" title="Input matcher et deweynummer. For å matche en hel serie, føy til *. Bruk OR for å kombinere: 364* OR 916*.">?</span>
                    </label>
                    <input id="dewey" type="number" name="dewey" input type="number" />
                </div>

            <!--Felt for valg av år-->
                <div id="search-type-selection">
                    <label for="from_year">Fra år:
                    </label>
                    <input id="from_year" type="number" name="from_year" min="1810" max="2024" input type="number" placeholder="1879" />
                </div>

            <!--Felt for valg av år-->
                <div id="search-type-selection">
                    <label for="to_year">Til år:</label> 
                    <input id="to_year" type="number" name="to_year" min="1810" max="2024" type="number" placeholder="1880" />
                </div>
        
        </div> <!--end class search container-->

        <h2>Lag korpuset og last ned metadata</h2>

        <div class="make-corpus">

        <!--Maks antall-->
            <div id="search-type-num-docs">
                <label for="num_docs">Maks antall, inntil 20 000:</label> 
                <input id="num_docs" type="number" name="num_docs" min="1" max="20000" type="number" value="2000" />
            </div>
 
        <!--Dropdownmeny for metode av uthenting-->
            <div id="search-type-extraction">
                <label for="search-type" class="search-type-label">Metode for uthenting:
                    <span class="help-icon" title="Metode 'first' er raskest, og velger dokument etter hvert som de blir funnet. 'rank' gir en rask ordning på dokumenter om korpuset er definert med et fulltekstsøk og sorterer på relevans. 'random' samler først inn hele korpuset og gjør deretter et vilkårlig utvalg av tekster derfra.">?</span>
                </label>
                <select name="type_" hx-get="search_type" hx-target="#search">
                    <option value="first">first</option>
                    <option value="rank">rank</option>
                    <option value="random">random</option>
                </select>
            </div>

        <!--Filnavn for nedlastning-->
            <div id="search-type-download">
                <label for="name">Filnavn for nedlastning:</label>
                <input type="text" id="corpus_name" name="corpus_name" value="korpus.xlsx"/>
            </div>
    
        </div> <!--End class make-corpus-->

        <div class="submit-button">
            <div id="button-1">
                <button type="submit">Trykk her når korpusdefinisjonen er klar</button>
            </div>
        </div>
    </form>


    <form id="download" hx-trigger= "clicked, submit", hx-post="/download-excel" hx-target="#form-feedback" hx-swap="outerHTML">
    <div class="download-button"> 
        <div id="download-button">
            <!--<button type="submit">Last ned skjema i excelformat</button>-->
            <button type="submit" hx-get="/download-excel" hx-trigger="click">Last ned skjema i excelformat</button>
        </div>
    </div>
    </form>

    <!---Her skal resultatene vises-->

    <table id="results-table" class="display" style="width:100%">
        <thead>
            <tr>
                <th>dhlabid</th>
                <th>authors</th>
                <th>title</th>
                <th>city</th>
                <th>timestamp</th>
                <th>year</th>
            </tr>
        </thead>
        <!--<tfoot>
            <tr>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
            </tr>
        </tfoot>-->
    </table>
     
    <script>
    $('#results-table').DataTable( {
        ajax: {
            url: '/submit-form',
            dataSrc: ''
        },
        columns: [  
        { data: 'authors' },
        { data: 'city' },
        { data: 'dhlabid' },
        { data: 'langs' },
        { data: 'publisher' },
        { data: 'subjects' }
        { data: 'timestamp' }
        { data: 'title' }
        { data: 'year' }
                ],
        processing: true,
        serverSide: true
    } );
    </script>

    <!--<form id="search-form" hx-trigger= "clicked, submit", hx-post="/get-results" hx-target="#form-feedback" hx-swap="outerHTML"></form></form>-->

    <!-- This section will be updated dynamically when the form is submitted (Dette er fra chatGPT, usikker om jeg trenger) -->
    <div id="user-input-output"></div>

    </main>
    {% endblock content %}